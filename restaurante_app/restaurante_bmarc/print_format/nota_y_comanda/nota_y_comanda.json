{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2025-05-27 00:01:15.503765",
 "css": " @media print {\r\n      body {\r\n        font-family: 'Courier New', monospace;\r\n        font-size: 12px;\r\n        width: 72mm;\r\n        margin: 0;\r\n        padding: 0;\r\n      }\r\n\r\n      h2, p, h4 {\r\n        margin: 2px 0;\r\n        padding: 0;\r\n          font-size: 10px;\r\n      }\r\n\r\ntable {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n  font-size: 10px;\r\n}\r\n\r\nth, td {\r\n  text-align: left;\r\n  padding: 2px 0;       /* Reducido */\r\n  line-height: 1.2;     /* M\u00e1s compacto */\r\n}\r\n\r\nth {\r\n  font-weight: bold;\r\n  border-bottom: 1px solid black;\r\n}\r\n\r\n\r\n      .centrado {\r\n        text-align: center;\r\n      }\r\n\r\n      .totales {\r\n        text-align: right;\r\n        font-weight: bold;\r\n        margin-top: 10px;\r\n      }\r\n\r\n      hr {\r\n        border: none;\r\n        border-top: 1px dashed #000;\r\n        margin: 6px 0;\r\n      }\r\n\r\n      .firma {\r\n        text-align: center;\r\n        font-size: 10px;\r\n        margin-top: 20px;\r\n      }\r\n\r\n      .page-break {\r\n        page-break-after: always;\r\n      }\r\n    }\r\n\r\n    body {\r\n      font-family: 'Courier New', monospace;\r\n      font-size: 12px;\r\n      max-width: 72mm;\r\n      margin: auto;\r\n      color: black;\r\n    }",
 "custom_format": 1,
 "default_print_language": "es-EC",
 "disabled": 0,
 "doc_type": "orders",
 "docstatus": 0,
 "doctype": "Print Format",
 "font_size": 14,
 "html": "{# ------------------ NOTA DE VENTA / FACTURA (ORDERS/SALES INVOICE) ------------------ #}\r\n\r\n{% macro money(n) %}{{ \"{:,.2f}\".format(((n if n is not none else 0) | float)) }}{% endmacro %}\r\n\r\n{# \u00bfEs factura? Trae la Sales Invoice por order #}\r\n{% set is_factura = (doc.estado == \"Factura\") %}\r\n{% set inv = None %}\r\n{% if is_factura %}\r\n  {% set sinv_list = frappe.get_all(\"Sales Invoice\",\r\n      filters={\"order\": doc.name, \"docstatus\": [\"!=\", 2]},\r\n      fields=[\"name\"],\r\n      limit=1\r\n  ) %}\r\n  {% if sinv_list and sinv_list|length > 0 %}\r\n    {% set inv = frappe.get_doc(\"Sales Invoice\", sinv_list[0].name) %}\r\n  {% endif %}\r\n{% endif %}\r\n\r\n{# Fuente de datos (invoice si existe, si no la orden) #}\r\n{% set src = inv if inv else doc %}\r\n\r\n{# Company desde la fuente #}\r\n{% set company_name = (src.company if src.get(\"company\") else doc.company_id) %}\r\n{% set company = frappe.get_doc(\"Company\", company_name) if company_name else None %}\r\n{% set logo_url = frappe.utils.get_url(company.logo) if company and company.logo else None %}\r\n\r\n{% if logo_url %}\r\n  <div style=\"text-align:center;margin-bottom:10px\">\r\n    <img src=\"{{ logo_url }}\" alt=\"Logo\" style=\"height:80px\">\r\n  </div>\r\n{% endif %}\r\n\r\n{# T\u00edtulo #}\r\n<h2 class=\"centrado\">{{ \"FACTURA\" if inv else \"NOTA DE VENTA\" }}</h2>\r\n\r\n{# Encabezado de factura (sin fecha de autorizaci\u00f3n) #}\r\n{% if inv and company %}\r\n  <div style=\"font-size:10px;line-height:1.4\">\r\n    <p><strong>RUC Emisor:</strong> {{ company.ruc or 'N/A' }}</p>\r\n    <p><strong>Direcci\u00f3n:</strong> {{ company.address or 'N/A' }}</p>\r\n    {% if inv.estab and inv.ptoemi and inv.secuencial %}\r\n      <p><strong>Factura:</strong> {{ inv.estab }}-{{ inv.ptoemi }}-{{ inv.secuencial }}</p>\r\n    {% endif %}\r\n    {% if inv.access_key %}\r\n      <p><strong>Clave de Acceso:</strong> <span style=\"word-break:break-word\">{{ inv.access_key }}</span></p>\r\n    {% endif %}\r\n  </div>\r\n{% endif %}\r\n\r\n<div style=\"font-size:10px;line-height:1.4\">\r\n  {# Fecha de emisi\u00f3n: creation/posting de la fuente #}\r\n  {% set fec = (inv.creation if inv else doc.get(\"fecha_emision\") or doc.creation) %}\r\n  <p><strong>Fec. Emisi\u00f3n:</strong> {{ frappe.utils.format_datetime(fec, \"dd/MM/yyyy HH:mm\") }}</p>\r\n\r\n  {# Cliente #}\r\n  {% set cli_nombre = frappe.db.get_value(\"Cliente\", doc.customer, \"nombre\") or doc.customer %}\r\n  {% set cli_id    = frappe.db.get_value(\"Cliente\", doc.customer, \"num_identificacion\") or \"\" %}\r\n  {% set cli_mail  = frappe.db.get_value(\"Cliente\", doc.customer, \"correo\") or \"\" %}\r\n  {% set cli_tel   = frappe.db.get_value(\"Cliente\", doc.customer, \"telefono\") or \"\" %}\r\n  {% set cli_dir   = frappe.db.get_value(\"Cliente\", doc.customer, \"direccion\") or \"\" %}\r\n\r\n  <hr>\r\n  <p><strong>Cliente:</strong> {{ cli_nombre }}</p>\r\n  <p><strong>Identificaci\u00f3n:</strong> {{ cli_id }}</p>\r\n  {% if cli_mail %}<p><strong>Correo:</strong> {{ cli_mail }}</p>{% endif %}\r\n  {% if cli_tel %}<p><strong>Tel\u00e9fono:</strong> {{ cli_tel }}</p>{% endif %}\r\n  {% if cli_dir %}<p><strong>Direcci\u00f3n:</strong> {{ cli_dir }}</p>{% endif %}\r\n  {% if doc.alias %}<p class=\"centrado\"><strong>Alias:</strong> {{ doc.alias }}</p>{% endif %}\r\n  <p class=\"centrado\"><strong>Orden:</strong> {{ doc.name }}</p>\r\n</div>\r\n\r\n<hr>\r\n\r\n{# ======================= ACUMULADORES POR TASA ======================= #}\r\n{% set ns = namespace(\r\n  base0=0.0, base5=0.0, base12=0.0, base13=0.0, base14=0.0, base15=0.0,\r\n  iva0=0.0,  iva5=0.0,  iva12=0.0,  iva13=0.0,  iva14=0.0,  iva15=0.0,\r\n  subtotal=0.0, ivatotal=0.0\r\n) %}\r\n\r\n{# Fuente de items: inv.items si existe, si no doc.items #}\r\n{% set items_src = (inv.items if inv else doc.items) %}\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Producto</th>\r\n      <th style=\"text-align:center\">Cant</th>\r\n      <th style=\"text-align:right\">Precio</th>\r\n      <th style=\"text-align:center\">IVA</th>\r\n      <th style=\"text-align:right\">Subtotal</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    {% for it in items_src %}\r\n      {# % IVA por l\u00ednea:\r\n         - En invoice: it.tax_rate (num, p.ej. 15)\r\n         - En order:   it.tax_rate (si trae) o lookup en Doctype 'taxes'\r\n      #}\r\n      {% if inv %}\r\n        {% set tax_rate = (it.tax_rate or 0) | float %}\r\n      {% else %}\r\n        {% set tax_rate =\r\n          (it.tax_rate if (it.get(\"tax_rate\") is not none) else (frappe.db.get_value('taxes', it.tax, 'value') or 0)\r\n          ) | float %}\r\n      {% endif %}\r\n\r\n      {% set qty  = (it.qty  or 0) | float %}\r\n      {% set rate = (it.rate or 0) | float %}\r\n      {% set base = (qty * rate) | float %}\r\n      {% set iva_line = (base * tax_rate / 100.0) | float %}\r\n\r\n      {# Acumular totales #}\r\n      {% set ns.subtotal = ns.subtotal + base %}\r\n      {% set ns.ivatotal = ns.ivatotal + iva_line %}\r\n\r\n      {# Acumular por tasa #}\r\n      {% if (tax_rate | int) == 0 %}\r\n        {% set ns.base0 = ns.base0 + base %}{% set ns.iva0 = ns.iva0 + iva_line %}\r\n      {% elif (tax_rate | int) == 5 %}\r\n        {% set ns.base5 = ns.base5 + base %}{% set ns.iva5 = ns.iva5 + iva_line %}\r\n      {% elif (tax_rate | int) == 12 %}\r\n        {% set ns.base12 = ns.base12 + base %}{% set ns.iva12 = ns.iva12 + iva_line %}\r\n      {% elif (tax_rate | int) == 13 %}\r\n        {% set ns.base13 = ns.base13 + base %}{% set ns.iva13 = ns.iva13 + iva_line %}\r\n      {% elif (tax_rate | int) == 14 %}\r\n        {% set ns.base14 = ns.base14 + base %}{% set ns.iva14 = ns.iva14 + iva_line %}\r\n      {% elif (tax_rate | int) == 15 %}\r\n        {% set ns.base15 = ns.base15 + base %}{% set ns.iva15 = ns.iva15 + iva_line %}\r\n      {% else %}\r\n        {# tasas no contempladas -> 0% por seguridad #}\r\n        {% set ns.base0 = ns.base0 + base %}{% set ns.iva0 = ns.iva0 + 0 %}\r\n      {% endif %}\r\n\r\n      {# Nombre del producto #}\r\n      {% if inv %}\r\n        {% set prod_name = it.item_name or it.item_code %}\r\n      {% else %}\r\n        {% set prod_name = frappe.db.get_value(\"Producto\", it.product, \"nombre\") or it.product %}\r\n      {% endif %}\r\n\r\n      <tr>\r\n        <td>{{ prod_name }}</td>\r\n        <td style=\"text-align:center\">{{ \"{:g}\".format(qty) }}</td>\r\n        <td style=\"text-align:right\">${{ money(rate) }}</td>\r\n        <td style=\"text-align:center\">{{ (tax_rate | int) }}%</td>\r\n        <td style=\"text-align:right\">${{ money(base) }}</td>\r\n      </tr>\r\n    {% endfor %}\r\n  </tbody>\r\n</table>\r\n\r\n<hr>\r\n\r\n{# ========== TOTALES DIN\u00c1MICOS POR TASA ========== #}\r\n{% if ns.base15 > 0 %}\r\n  <p class=\"totales\">Subtotal 15%: ${{ money(ns.base15) }}</p>\r\n  <p class=\"totales\">IVA 15%: ${{ money(ns.iva15) }}</p>\r\n{% endif %}\r\n{% if ns.base14 > 0 %}\r\n  <p class=\"totales\">Subtotal 14%: ${{ money(ns.base14) }}</p>\r\n  <p class=\"totales\">IVA 14%: ${{ money(ns.iva14) }}</p>\r\n{% endif %}\r\n{% if ns.base13 > 0 %}\r\n  <p class=\"totales\">Subtotal 13%: ${{ money(ns.base13) }}</p>\r\n  <p class=\"totales\">IVA 13%: ${{ money(ns.iva13) }}</p>\r\n{% endif %}\r\n{% if ns.base12 > 0 %}\r\n  <p class=\"totales\">Subtotal 12%: ${{ money(ns.base12) }}</p>\r\n  <p class=\"totales\">IVA 12%: ${{ money(ns.iva12) }}</p>\r\n{% endif %}\r\n{% if ns.base5 > 0 %}\r\n  <p class=\"totales\">Subtotal 5%: ${{ money(ns.base5) }}</p>\r\n  <p class=\"totales\">IVA 5%: ${{ money(ns.iva5) }}</p>\r\n{% endif %}\r\n{% if ns.base0 > 0 %}\r\n  <p class=\"totales\">Subtotal 0%: ${{ money(ns.base0) }}</p>\r\n{% endif %}\r\n\r\n<p class=\"totales\">Subtotal: ${{ money(ns.subtotal) }}</p>\r\n<p class=\"totales\">IVA: ${{ money(ns.ivatotal) }}</p>\r\n<p class=\"totales\"><strong>Total: ${{ money(ns.subtotal + ns.ivatotal) }}</strong></p>\r\n\r\n{# ========== Formas de Pago (opcional) ========== #}\r\n{% if doc.payments and doc.payments|length > 0 %}\r\n  <h4>Formas de Pago:</h4>\r\n  <ul>\r\n    {% for p in doc.payments %}\r\n      {% set pago_dt = 'payments' if frappe.db.exists('payments', p.formas_de_pago) else 'method_of_payment' %}\r\n      {% set metodo = frappe.get_doc(pago_dt, p.formas_de_pago) %}\r\n      {% set monto = p.get('monto') or p.get('amount') or p.get('valor') %}\r\n      <li>{{ metodo.description or metodo.nombre or metodo.name }}{% if monto %} \u2014 ${{ money(monto) }}{% endif %}</li>\r\n    {% endfor %}\r\n  </ul>\r\n{% endif %}\r\n\r\n<div class=\"firma\">Gracias por su compra</div>\r\n\r\n{# ------------------ COMANDA (siempre desde la orden) ------------------ #}\r\n<div class=\"page-break\"></div>\r\n<h2 class=\"centrado\">COMANDA</h2>\r\n{% if doc.alias %}<p><strong>Alias:</strong> {{ doc.alias }}</p>{% endif %}\r\n<p><strong>Orden:</strong> {{ doc.name }}</p>\r\n<p><strong>Fecha:</strong> {{ frappe.utils.format_datetime(doc.creation, \"dd/MM/yyyy HH:mm\") }}</p>\r\n{% if doc.table %}<p><strong>Mesa:</strong> {{ doc.table }}</p>{% endif %}\r\n\r\n<hr>\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Producto</th>\r\n      <th style=\"text-align:center\">Cantidad</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    {% for item in doc.items %}\r\n      {% set prod_name_k = frappe.db.get_value(\"Producto\", item.product, \"nombre\") or item.product %}\r\n      <tr>\r\n        <td>{{ prod_name_k }}</td>\r\n        <td style=\"text-align:center\">{{ \"{:g}\".format(item.qty or 0) }}</td>\r\n      </tr>\r\n    {% endfor %}\r\n  </tbody>\r\n</table>\r\n\r\n<br><br>\r\n<p class=\"firma\">PREPARAR Y ENTREGAR</p>\r\n",
 "idx": 0,
 "line_breaks": 0,
 "margin_bottom": 15.0,
 "margin_left": 15.0,
 "margin_right": 15.0,
 "margin_top": 15.0,
 "modified": "2025-08-25 14:42:30.761494",
 "modified_by": "Administrator",
 "module": "Restaurante BMARC",
 "name": "Nota y Comanda",
 "owner": "Administrator",
 "page_number": "Hide",
 "print_format_builder": 0,
 "print_format_builder_beta": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}