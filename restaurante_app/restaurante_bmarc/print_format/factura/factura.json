{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2025-06-23 23:32:28.207992",
 "css": "",
 "custom_format": 1,
 "default_print_language": "es-EC",
 "disabled": 0,
 "doc_type": "orders",
 "docstatus": 0,
 "doctype": "Print Format",
 "font_size": 14,
 "html": "{% set comp = doc.get_context() %}\r\n{% set customer = frappe.get_doc('Cliente', doc.customer) %}\r\n\r\n<style>\r\n  @page {\r\n    size: A4;\r\n    margin: 1.5cm;\r\n  }\r\n  @font-face {\r\n    font-family: 'Code128';\r\n    src: url('{{ frappe.utils.get_url() }}/assets/restaurante_app/fonts/code128.ttf') format('truetype');\r\n  }\r\n  .t { border: 1px solid #ccc; padding: 5px; }\r\n</style>\r\n\r\n{# =======================\r\n   ACUMULADORES DE IVA\r\n   ======================= #}\r\n{% set ns = namespace(\r\n  base0=0.0, base5=0.0, base12=0.0, base13=0.0, base14=0.0, base15=0.0,\r\n  iva0=0.0,  iva5=0.0,  iva12=0.0,  iva13=0.0,  iva14=0.0,  iva15=0.0,\r\n  subtotal=0.0, ivatotal=0.0\r\n) %}\r\n\r\n{# Nota: asumimos que items.total es el subtotal de l\u00ednea SIN IVA (como en tu front).\r\n   Si no, usa (items.qty * items.rate) como base. #}\r\n\r\n<!-- ENCABEZADO EN 2 COLUMNAS -->\r\n<div style=\"display: flex; justify-content: space-between; gap: 15px; align-items: flex-start; margin-bottom: 20px;\">\r\n\r\n  <div style=\"margin-top: 15px; overflow: hidden;\">\r\n\r\n    <!-- COLUMNA 1: EMPRESA -->\r\n    <div style=\"width: 48%; float: left;\">\r\n      {% if doc.company_logo %}\r\n      <img src=\"{{ doc.company_logo }}\" style=\"max-height: 60px; margin-bottom: 5px;\"><br>\r\n      {% endif %}\r\n      <strong>{{ doc.company_name }}</strong><br>\r\n      {{ doc.company_address }}<br>\r\n      Tel: {{ doc.company_phone }}<br>\r\n      Email: {{ doc.company_email }}<br>\r\n      Contribuyente Especial Nro: {{ doc.company_contribuyente or 'N/A' }}<br>\r\n      Obligado a llevar contabilidad: {{ doc.company_contabilidad or 'NO' }}<br>\r\n    </div>\r\n\r\n    <!-- COLUMNA 2: FACTURA + SRI -->\r\n    <div style=\"width: 48%; float: right; border: 1px solid #000; padding: 10px; font-size: 10px; background-color: #f3f3f3; text-align: center;\">\r\n      <div><strong>R.U.C.:</strong> {{ doc.company_ruc }}</div>\r\n      <div style=\"font-size: 14px; font-weight: bold;\">FACTURA</div>\r\n      <div><strong>No.:</strong> {{ doc.estab }}-{{ doc.ptoemi }}-{{ doc.secuencial }}</div>\r\n      <div><strong>No. de Autorizaci\u00f3n:</strong></div>\r\n      <div>{{ doc.clave_acceso }}</div>\r\n      <div><strong>Fecha y hora de Autorizaci\u00f3n:</strong></div>\r\n      <div>{{ doc.fecha_autorizacion or '' }}</div>\r\n      <p><strong>Ambiente:</strong>\r\n        {% if doc.ambiente == \"1\" %}PRUEBAS\r\n        {% elif doc.ambiente == \"2\" %}PRODUCCI\u00d3N\r\n        {% else %}DESCONOCIDO\r\n        {% endif %}\r\n      </p>\r\n      <div><strong>Emisi\u00f3n:</strong> NORMAL</div>\r\n      <div><strong>CLAVE DE ACCESO</strong></div>\r\n      <div style=\"font-family: 'Code128'; font-size: 28px; text-align: center; white-space: nowrap; overflow: hidden; line-height: 1; margin-top: 10px;\">\r\n        {{ doc.clave_acceso or '' }}\r\n      </div>\r\n      <div style=\"font-size: 9px; margin-top: 4px;\">{{ doc.clave_acceso or '' }}</div>\r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n\r\n<!-- Cliente -->\r\n<table style=\"width: 100%; border-collapse: collapse; font-size: 10px; margin-top: 10px; page-break-inside: avoid;\">\r\n  <tr>\r\n    <td class=\"t\"><strong>Raz\u00f3n Social / Nombres:</strong> {{ doc.nombre_cliente }}</td>\r\n    <td class=\"t\"><strong>Fecha Emisi\u00f3n:</strong> {{ doc.fecha_emision }}</td>\r\n  </tr>\r\n  <tr>\r\n    <td class=\"t\"><strong>Identificaci\u00f3n:</strong> {{ doc.identificacion_cliente }}</td>\r\n    <td class=\"t\"><strong>Direcci\u00f3n:</strong> {{ customer.direccion or '' }}</td>\r\n  </tr>\r\n  <tr>\r\n    <td class=\"t\"><strong>Email:</strong> {{ doc.email }}</td>\r\n    <td class=\"t\"><strong>Tel\u00e9fono:</strong> {{ customer.telefono }}</td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- Detalle de Productos -->\r\n<table style=\"width: 100%; border-collapse: collapse; font-size: 10px; margin-top: 10px; page-break-inside: avoid;\">\r\n  <thead>\r\n    <tr style=\"background-color: #eaeaea; font-weight: bold;\">\r\n      <th class=\"t\">C\u00f3digo</th>\r\n      <th class=\"t\">Cantidad</th>\r\n      <th class=\"t\">Descripci\u00f3n</th>\r\n      <th class=\"t\">Precio Unitario</th>\r\n      <th class=\"t\">Descuento</th>\r\n      <th class=\"t\">Total</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    {% for items in doc.items %}\r\n      {# === C\u00e1lculos por l\u00ednea === #}\r\n      {% set tax_value = (frappe.db.get_value('taxes', items.tax, 'value') or 0) | float %}\r\n\r\n      {% set base = (items.total if items.total is not none else (items.qty * items.rate)) | float %}\r\n      {% set iva_line = (base * tax_value / 100.0) | float %}\r\n\r\n      {# Acumular #}\r\n      {% set ns.subtotal = ns.subtotal + base %}\r\n      {% set ns.ivatotal = ns.ivatotal + iva_line %}\r\n      {% if tax_value|int == 0 %}\r\n        {% set ns.base0 = ns.base0 + base %}{% set ns.iva0 = ns.iva0 + iva_line %}\r\n      {% elif tax_value|int == 5 %}\r\n        {% set ns.base5 = ns.base5 + base %}{% set ns.iva5 = ns.iva5 + iva_line %}\r\n      {% elif tax_value|int == 12 %}\r\n        {% set ns.base12 = ns.base12 + base %}{% set ns.iva12 = ns.iva12 + iva_line %}\r\n      {% elif tax_value|int == 13 %}\r\n        {% set ns.base13 = ns.base13 + base %}{% set ns.iva13 = ns.iva13 + iva_line %}\r\n      {% elif tax_value|int == 14 %}\r\n        {% set ns.base14 = ns.base14 + base %}{% set ns.iva14 = ns.iva14 + iva_line %}\r\n      {% elif tax_value|int == 15 %}\r\n        {% set ns.base15 = ns.base15 + base %}{% set ns.iva15 = ns.iva15 + iva_line %}\r\n      {% endif %}\r\n\r\n      {# Render de la fila #}\r\n      {% set item = frappe.get_doc('Producto', items.product) %}\r\n      <tr>\r\n        <td class=\"t\">{{ items.product }}</td>\r\n        <td class=\"t\" style=\"text-align: right;\">{{ items.qty }}</td>\r\n        <td class=\"t\">{{ item.nombre }} {{ item.descripcion or '' }}</td>\r\n        <td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(items.rate) }}</td>\r\n        <td class=\"t\" style=\"text-align: right;\">0.00</td>\r\n        <td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(base) }}</td>\r\n      </tr>\r\n    {% endfor %}\r\n  </tbody>\r\n</table>\r\n\r\n<!-- Pagos y Totales -->\r\n<div style=\"margin-top: 15px; overflow: hidden;\">\r\n\r\n  <!-- Pagos -->\r\n  <div style=\"width: 48%; float: left;\">\r\n    <table style=\"width: 100%; border-collapse: collapse; font-size: 10px;\">\r\n      <thead>\r\n        <tr style=\"background-color: #eaeaea; font-weight: bold;\">\r\n          <th class=\"t\">Forma de Pago</th>\r\n          <th class=\"t\">Valor</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {% for pay in doc.payments %}\r\n          {% set pago = frappe.get_doc('payments', pay.formas_de_pago) %}\r\n          <tr>\r\n            <td class=\"t\">{{ pago.description }}</td>\r\n            <td class=\"t\" style=\"text-align: right;\">\r\n              {{ \"%.2f\"|format((doc.total) | float) }}\r\n            </td>\r\n          </tr>\r\n        {% endfor %}\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n\r\n  <!-- Totales -->\r\n  <div style=\"width: 48%; float: right;\">\r\n    <table style=\"width: 100%; border-collapse: collapse; font-size: 10px;\">\r\n\r\n      {# Subtotales por tasa (solo si hay base) #}\r\n      {% if ns.base15 > 0 %}\r\n      <tr><td class=\"t\">Subtotal 15%</td><td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.base15) }}</td></tr>\r\n      {% endif %}\r\n      {% if ns.base14 > 0 %}\r\n      <tr><td class=\"t\">Subtotal 14%</td><td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.base14) }}</td></tr>\r\n      {% endif %}\r\n      {% if ns.base13 > 0 %}\r\n      <tr><td class=\"t\">Subtotal 13%</td><td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.base13) }}</td></tr>\r\n      {% endif %}\r\n      {% if ns.base12 > 0 %}\r\n      <tr><td class=\"t\">Subtotal 12%</td><td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.base12) }}</td></tr>\r\n      {% endif %}\r\n      {% if ns.base5 > 0 %}\r\n      <tr><td class=\"t\">Subtotal 5%</td><td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.base5) }}</td></tr>\r\n      {% endif %}\r\n      {% if ns.base0 > 0 %}\r\n      <tr><td class=\"t\">Subtotal 0%</td><td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.base0) }}</td></tr>\r\n      {% endif %}\r\n\r\n      <tr>\r\n        <td class=\"t\">Subtotal (sin impuestos)</td>\r\n        <td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.subtotal) }}</td>\r\n      </tr>\r\n\r\n      <tr><td class=\"t\">Descuento</td><td class=\"t\" style=\"text-align: right;\">0.00</td></tr>\r\n\r\n      {# IVA por tasa (omite 0%) #}\r\n      {% if ns.iva15 > 0 %}\r\n      <tr><td class=\"t\">IVA 15%</td><td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.iva15) }}</td></tr>\r\n      {% endif %}\r\n      {% if ns.iva14 > 0 %}\r\n      <tr><td class=\"t\">IVA 14%</td><td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.iva14) }}</td></tr>\r\n      {% endif %}\r\n      {% if ns.iva13 > 0 %}\r\n      <tr><td class=\"t\">IVA 13%</td><td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.iva13) }}</td></tr>\r\n      {% endif %}\r\n      {% if ns.iva12 > 0 %}\r\n      <tr><td class=\"t\">IVA 12%</td><td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.iva12) }}</td></tr>\r\n      {% endif %}\r\n      {% if ns.iva5 > 0 %}\r\n      <tr><td class=\"t\">IVA 5%</td><td class=\"t\" style=\"text-align: right;\">{{ \"%.2f\"|format(ns.iva5) }}</td></tr>\r\n      {% endif %}\r\n\r\n      <tr>\r\n        <td class=\"t\"><strong>Valor Total</strong></td>\r\n        <td class=\"t\" style=\"text-align: right;\"><strong>{{ \"%.2f\"|format(ns.subtotal + ns.ivatotal) }}</strong></td>\r\n      </tr>\r\n    </table>\r\n  </div>\r\n</div>\r\n\r\n{# Pie opcional #}\r\n{# <div style=\"clear: both; text-align: center; font-size: 9px; color: #666; margin-top: 30px;\">\r\n  Este documento es una representaci\u00f3n gr\u00e1fica del Comprobante Electr\u00f3nico autorizado por el SRI<br>\r\n  www.sri.gob.ec\r\n</div> #}\r\n",
 "idx": 0,
 "line_breaks": 0,
 "margin_bottom": 15.0,
 "margin_left": 15.0,
 "margin_right": 15.0,
 "margin_top": 15.0,
 "modified": "2025-08-14 00:12:33.741974",
 "modified_by": "Administrator",
 "module": "Restaurante BMARC",
 "name": "Factura",
 "owner": "Administrator",
 "page_number": "Hide",
 "pdf_generator": "wkhtmltopdf",
 "print_format_builder": 0,
 "print_format_builder_beta": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}